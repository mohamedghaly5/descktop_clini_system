# نظام الاتصال والشبكة المحلية (System Architecture)

يعتمد التطبيق على معمارية **Server-Client** (خادم وعميل) لتمكين أجهزة متعددة من العمل على نفس قاعدة البيانات داخل الشبكة المحلية (Local Network).

## 1. الأدوار (Roles)

### الجهاز الرئيسي (Server)
*   **الوظيفة:** هو الجهاز الذي يحتوي على قاعدة البيانات الكاملة (`dental.db`).
*   **المهام:**
    *   تشغيل خادم بيانات داخلي (API Server) على المنفذ `3000`.
    *   معالجة جميع طلبات القراءة والكتابة من الأجهزة الأخرى.
    *   إدارة قاعدة البيانات والنسخ الاحتياطي.
*   **نمط التشغيل:** Server/Local Mode.

### الأجهزة الفرعية (Clients)
*   **الوظيفة:** أجهزة تستخدم للعرض والإدخال فقط.
*   **المهام:**
    *   لا تحتفظ بأي بيانات عمل محلياً.
    *   تتصل بالجهاز الرئيسي عن طريق عنوان الشبكة (IP Address).
    *   ترسل الأوامر (مثل إضافة مريض، حجز موعد) إلى السيرفر ليقوم بتنفيذها.
*   **نمط التشغيل:** Client Mode.

---

## 2. آلية الاتصال (Communication Flow)

يتم الاتصال عبر بروتوكول **HTTP** القياسي (مثل تصفح المواقع)، مما يضمن سرعة واستقرار الاتصال.

1.  **اكتشاف السيرفر:** عند تشغيل العميل، يبحث عن عنوان السيرفر المسجل (IP) (مثل `192.168.1.5`).
2.  **إرسال الطلب:**
    *   عندما يقوم الطبيب بإضافة مريض جديد على جهاز العميل.
    *   يقوم البرنامج بإرسال طلب "POST" إلى `http://192.168.1.5:3000/api/patients`.
3.  **المعالجة:**
    *   يستقبل السيرفر الطلب.
    *   يتحقق من الصلاحيات (هل المستخدم مسجل دخول؟).
    *   ينفذ الأمر في قاعدة البيانات المحلية.
4.  **الرد:**
    *   يعيد السيرفر رسالة نجاح أو خطأ (JSON Response) للعميل ليتم تحديث الشاشة.

---

## 3. الأمان والمصادقة (Security)

*   **تسجيل الدخول:** يتم إرسال رقم المعرف (User ID) وكود الدخول (PIN) (مشفرًا) إلى السيرفر.
*   **الرموز (Tokens):** عند نجاح الدخول، يعطي السيرفر "تذكرة مرور" (Token) للعميل.
*   **التحقق:** أي طلب لاحق (عرض بيانات، تعديل) يجب أن يرفق هذه التذكرة، وإلا سيرفض السيرفر الطلب فوراً.

## 4. المنافذ المستخدمة (Ports)
*   **3000:** مخصص لتبادل البيانات (API).
*   **8080/5173:** مخصص لواجهة المستخدم (في وضع التطوير).

---

## ملخص تقني للمطورين
*   **API Framework:** Express.js running inside Electron Main Process.
*   **Protocol:** HTTP/REST.
*   **Database:** SQLite (Better-SQLite3) running on Server only.
*   **Discovery:** Manual IP entry (Configuration).
